setwd("~/GitHub/stroke-trf")
rm(list = ls())

### code exported from BioRad CFX Maestro Software version 4.1.24.33.1219

# validation of the top 6 stroke-perturbed tRFs in a separate cohort of stroke
# patients n=32, vs n=10 control (Figure 2)

#check and install required packages
pacman::p_load(car, lsmeans)

ShapiroTest <- function(x){
  z <- length(x)
  if(z > 2 && z < 5001){
    y <- shapiro.test(x)
    return (c(w=unname(y$statistic), p=y$p.value, n=z))
  }
  return (c(w=NA, p=NA, n=z))
}

OneWayAnova <- function(data, dv, iv, conf = 0.95, toJSON = FALSE){
 
  alpha = 1 - conf
  ndigits = 10
  
  df <- data
  
  # empty result object
  r <- {}
  dfFormula <- as.formula(paste(dv, iv, sep=" ~ "))
  df.res <- lm(dfFormula, data = df)
  r$aov <- do.call(rbind.data.frame, summary(aov(df.res)))
  
  r$aov <- cbind(Source=rownames(r$aov), r$aov)

  suppressWarnings(suppressMessages(library(lsmeans)))

  t<- suppressMessages(pairs(lsmeans(df.res, iv)))
    
  ts <- summary(t)
  tc <- confint(t, level = conf)
  r$t <- merge(ts, tc)  

  r$s <- aggregate(formula=dfFormula,
				   data=df,
				   FUN=ShapiroTest)

  return(r)
}

#tRF-18-8R6546D2
exp188R5 <- c(0.74273386389015,0.00112729098064968,1.94567440993777,1.16622923629396,0.972486926637036,0.828986785700264,0.480613828192632,0.372342874253938,0.80474231078825,-0.396032492874078,1.62917171830029,0.528736820811901,1.19226003272559,0.268972617333791,0.94576923760464,0.591073119078735,0.663337450627596,0.639443968508629,1.38757619162049,1.98377649696374,0.768332555725342,0.560072573023158,0.807690313631878,1.25542618278487,1.91214426243688,0.491231822541565,1.56160956273952,0.0796510410153834,0.741833329052855,0.878840891796301,1.17306263573232,1.11922813466606,0.570450877498072,-1.61141920368418,-0.173471206846051,0.747813622753581,-0.313944844139655,0.693456448614134,-0.0906275109092201,-1.19332028071818,0.163663043706558,1.20739905372492)
bg188R5 <- c("stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","control","control","control","control","control","control","control","control","control","control")
df188R5 <- data.frame(exp188R5, bg188R5)
OneWayAnova(data = df188R5, dv = "exp188R5", iv = "bg188R5", conf = 0.95)

#tRF-18-8R6Q46D2
exp188RQ <- c(0.809143854830973,0.0974316967580418,2.14805889334825,1.14017486889788,0.991498760106172,0.919686974532788,0.62257259513039,0.421886221472288,0.817458754426138,-0.321691702546521,1.66221557132851,0.489985699466523,1.23400593709645,0.356296658819279,1.02463407178699,0.462060255742457,0.642225274736349,0.586800714863052,1.39539694275661,1.99641095755203,0.757406965805896,0.495100534896014,0.671948505451771,1.22075352537943,2.04254413291067,0.538294079605787,1.47437125796104,0.242457114907035,0.814903984662481,0.960918693885521,1.19787667686524,0.992967697693978,0.556902011307596,-1.62000693717555,0.0015110263125048,0.771508377337168,-0.503234717901968,0.696213469905823,-0.0320649160052627,-1.09922124489163,0.0603564577855786,1.16803647332572)
bg188RQ <- c("stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","control","control","control","control","control","control","control","control","control","control")
df188RQ <- data.frame(exp188RQ, bg188RQ)
OneWayAnova(data = df188RQ, dv = "exp188RQ", iv = "bg188RQ", conf = 0.95)

#tRF-18-HR0VX6D2
exp18HRO <- c(0.953768094145536,0.380118281413969,2.22538607270862,1.24429716803917,0.712942203862632,0.596683431615415,0.627016181335684,0.460104565342021,0.452219223785001,0.205247443669609,1.37892703300911,0.651707949268047,1.39050953449598,0.59432941429884,0.822306082276594,0.414449408260853,0.606646265835211,1.36869237875898,1.38035478831011,1.96000496526976,0.92633102854509,0.859742211688139,0.925029535729462,1.25962186775692,2.07166115294307,0.86395637546655,1.92416111111664,0.82047291757433,0.998547189974043,1.69412303972629,1.65093430438307,1.25701220239431,0.604844631888724,-2.13219144656109,0.254311584271767,0.61078427253633,0.240049044080393,0.48403839683475,-0.328833836188069,-1.0685145574861,0.139442448922873,1.19606946170041)
bg18HRO <- c("stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","control","control","control","control","control","control","control","control","control","control")
df18HRO <- data.frame(exp18HRO, bg18HRO)
OneWayAnova(data = df18HRO, dv = "exp18HRO", iv = "bg18HRO", conf = 0.95)

#tRF-22-8EKSP1852
exp228EK <- c(0.828260592539278,0.0830866634956154,2.05046625516269,1.15458669684609,0.960566744050645,0.91430515884666,0.665435857191196,0.350631802318269,0.809965401834777,-0.410961466020745,1.58453945376255,0.396880591039061,1.19593757347675,0.171583424099722,0.934612415708173,0.503102642235734,0.767560191424392,0.555070629045463,1.34641453850369,1.9555541408738,0.754199720002171,0.529229804306754,0.595999751488145,1.3915684988092,1.89463302979868,0.501923242267896,1.45160979960269,0.0600914516575753,0.798989984140785,0.989380080439996,1.24841810175651,1.14715685936685,0.649157633907535,-1.69173391556232,-0.125365593982886,0.800564772449176,-0.30999989424966,0.829776844173798,-0.139732754152922,-1.20151045403119,0.033596306007789,1.15524705544072)
bg228EK <- c("stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","control","control","control","control","control","control","control","control","control","control")
df228EK <- data.frame(exp228EK, bg228EK)
OneWayAnova(data = df228EK, dv = "exp228EK", iv = "bg228EK", conf = 0.95)

#tRF-22-WE8SPOX52
exp22SPOX <- c(0.451928799104136,0.0192442565519978,1.73721453314995,0.977830369934209,0.715000282928066,0.270140099592884,0.277100714456816,0.23881658643192,0.480306871232031,0.556800477314805,0.939177850666341,0.0853070581282474,0.942462775164339,0.571893867093006,0.242106584725157,-0.436023359523681,0.593485677886642,0.598451219875314,0.591237670269041,1.37448630214039,0.62490470579109,0.548945838942205,0.687079847555961,1.24437803063185,1.30945543360235,0.17546232089218,1.14077597470767,-0.0366283366373689,0.110981263786175,1.16897188263818,0.728905553408966,0.300123988895572,0.543609714611154,-1.41298002860989,0.472385878726095,0.810394865905563,0.656380568316259,0.224861707396149,-0.508708888603637,-1.27059733220973,-0.586603329273958,1.07125684374201)
bg22SPOX <- c("stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","control","control","control","control","control","control","control","control","control","control")
df22SPOX <- data.frame(exp22SPOX, bg22SPOX)
OneWayAnova(data = df22SPOX, dv = "exp22SPOX", iv = "bg22SPOX", conf = 0.95)

#tRF-22-WEKSPM852
exp22WEK <- c(0.849553922512753,0.209956845759253,2.14018367576303,1.30692636584689,1.10991177593168,0.942896538737963,0.7092336770016,0.583879546587404,0.847246545987052,-0.161324817697875,1.73082593910326,0.555193395462563,1.37248910727816,0.403480784735624,1.09666889314361,0.625869495257269,0.722403098453262,0.683995145218797,1.40361170715466,2.07037149317207,0.827129954549009,0.585132016679192,0.641831497258079,1.26055606915153,1.87241018692792,0.234763803219195,1.33439168607356,-0.0195914812076819,0.82727374646809,0.932456292807902,1.19396268290061,1.10022608198119,0.594744179305973,-1.48417415525964,-0.102643930540351,0.909108129694546,-0.263958575150259,0.597363392540833,-0.305896799964985,-1.21066707513295,0.0355151877382571,1.23060964676856)
bg22WEK <- c("stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","stroke","control","control","control","control","control","control","control","control","control","control")
df22WEK <- data.frame(exp22WEK, bg22WEK)
OneWayAnova(data = df22WEK, dv = "exp22WEK", iv = "bg22WEK", conf = 0.95)
